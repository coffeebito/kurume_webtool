<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0, viewport-fit=cover, interactive-widget=resizes-content">
    <title>ボードゲーム得点管理</title>

    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#667eea">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="得点管理">

    <meta name="mobile-web-app-capable" content="yes">

    <meta name="description" content="ボードゲーム用の得点管理アプリ">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="main-screen" id="mainScreen">
            <div class="mode-toggle">
                <button class="toggle-btn" id="personalModeBtn" onclick="switchToPersonalMode()">3人モード</button>
                <button class="toggle-btn active" id="multiModeBtn" onclick="switchToMultiMode()">4人モード</button>
                <span class="round-divider">|</span>
                <button class="toggle-btn" id="helpBtn" onclick="showHelpModal()">説明書</button>
            </div>
            <div class="round-toggle" id="roundToggle">
                <button class="round-btn active" type="button" data-round="0" onclick="setCurrentRound(0)">R1</button>
                <button class="round-btn" type="button" data-round="1" onclick="setCurrentRound(1)">R2</button>
                <button class="round-btn" type="button" data-round="2" onclick="setCurrentRound(2)">R3</button>
                <button class="round-btn" type="button" data-round="3" onclick="setCurrentRound(3)">R4</button>
                <span class="round-divider">|</span>
                <button class="round-btn reset-btn" type="button" onclick="showResetConfirmation()">初期化</button>
            </div>
            <div class="multi-player-section" id="personalSection" style="display: none;">
                <div class="section-title"><span class="section-title-text">プレイヤー暫定点</span></div>
                <div class="player-rows-container" id="personalRowsContainer">
                    <div class="player-row">
                        <button class="player-row-btn negative btn-minus-10" onclick="updatePersonalScore(1, -10)">-10</button>
                        <button class="player-row-btn negative btn-minus-5" onclick="updatePersonalScore(1, -5)">-5</button>
                        <button class="player-row-btn negative btn-minus-1" onclick="updatePersonalScore(1, -1)">-1</button>
                        <div class="player-row-score" id="personalPlayer1TempScore">0</div>
                        <button class="player-row-btn positive btn-plus-1" onclick="updatePersonalScore(1, 1)">+1</button>
                        <button class="player-row-btn positive btn-plus-5" onclick="updatePersonalScore(1, 5)">+5</button>
                        <button class="player-row-btn positive btn-plus-10" onclick="updatePersonalScore(1, 10)">+10</button>
                    </div>

                    <div class="player-row">
                        <button class="player-row-btn negative btn-minus-10" onclick="updatePersonalScore(2, -10)">-10</button>
                        <button class="player-row-btn negative btn-minus-5" onclick="updatePersonalScore(2, -5)">-5</button>
                        <button class="player-row-btn negative btn-minus-1" onclick="updatePersonalScore(2, -1)">-1</button>
                        <div class="player-row-score" id="personalPlayer2TempScore">0</div>
                        <button class="player-row-btn positive btn-plus-1" onclick="updatePersonalScore(2, 1)">+1</button>
                        <button class="player-row-btn positive btn-plus-5" onclick="updatePersonalScore(2, 5)">+5</button>
                        <button class="player-row-btn positive btn-plus-10" onclick="updatePersonalScore(2, 10)">+10</button>
                    </div>

                    <div class="player-row">
                        <button class="player-row-btn negative btn-minus-10" onclick="updatePersonalScore(3, -10)">-10</button>
                        <button class="player-row-btn negative btn-minus-5" onclick="updatePersonalScore(3, -5)">-5</button>
                        <button class="player-row-btn negative btn-minus-1" onclick="updatePersonalScore(3, -1)">-1</button>
                        <div class="player-row-score" id="personalPlayer3TempScore">0</div>
                        <button class="player-row-btn positive btn-plus-1" onclick="updatePersonalScore(3, 1)">+1</button>
                        <button class="player-row-btn positive btn-plus-5" onclick="updatePersonalScore(3, 5)">+5</button>
                        <button class="player-row-btn positive btn-plus-10" onclick="updatePersonalScore(3, 10)">+10</button>
                    </div>
                </div>
            </div>

            <div class="multi-player-section" id="multiPlayerSection" style="display: flex;">
                <div class="section-title"><span class="section-title-text">プレイヤー暫定点</span></div>
                <div class="player-rows-container">
                    <div class="player-row">
                        <button class="player-row-btn negative btn-minus-10" onclick="updateMultiPlayerScore(1, -10)">-10</button>
                        <button class="player-row-btn negative btn-minus-5" onclick="updateMultiPlayerScore(1, -5)">-5</button>
                        <button class="player-row-btn negative btn-minus-1" onclick="updateMultiPlayerScore(1, -1)">-1</button>
                        <div class="player-row-score" id="multiPlayer1Score">0</div>
                        <button class="player-row-btn positive btn-plus-1" onclick="updateMultiPlayerScore(1, 1)">+1</button>
                        <button class="player-row-btn positive btn-plus-5" onclick="updateMultiPlayerScore(1, 5)">+5</button>
                        <button class="player-row-btn positive btn-plus-10" onclick="updateMultiPlayerScore(1, 10)">+10</button>
                    </div>

                    <div class="player-row">
                        <button class="player-row-btn negative btn-minus-10" onclick="updateMultiPlayerScore(2, -10)">-10</button>
                        <button class="player-row-btn negative btn-minus-5" onclick="updateMultiPlayerScore(2, -5)">-5</button>
                        <button class="player-row-btn negative btn-minus-1" onclick="updateMultiPlayerScore(2, -1)">-1</button>
                        <div class="player-row-score" id="multiPlayer2Score">0</div>
                        <button class="player-row-btn positive btn-plus-1" onclick="updateMultiPlayerScore(2, 1)">+1</button>
                        <button class="player-row-btn positive btn-plus-5" onclick="updateMultiPlayerScore(2, 5)">+5</button>
                        <button class="player-row-btn positive btn-plus-10" onclick="updateMultiPlayerScore(2, 10)">+10</button>
                    </div>

                    <div class="player-row">
                        <button class="player-row-btn negative btn-minus-10" onclick="updateMultiPlayerScore(3, -10)">-10</button>
                        <button class="player-row-btn negative btn-minus-5" onclick="updateMultiPlayerScore(3, -5)">-5</button>
                        <button class="player-row-btn negative btn-minus-1" onclick="updateMultiPlayerScore(3, -1)">-1</button>
                        <div class="player-row-score" id="multiPlayer3Score">0</div>
                        <button class="player-row-btn positive btn-plus-1" onclick="updateMultiPlayerScore(3, 1)">+1</button>
                        <button class="player-row-btn positive btn-plus-5" onclick="updateMultiPlayerScore(3, 5)">+5</button>
                        <button class="player-row-btn positive btn-plus-10" onclick="updateMultiPlayerScore(3, 10)">+10</button>
                    </div>

                    <div class="player-row">
                        <button class="player-row-btn negative btn-minus-10" onclick="updateMultiPlayerScore(4, -10)">-10</button>
                        <button class="player-row-btn negative btn-minus-5" onclick="updateMultiPlayerScore(4, -5)">-5</button>
                        <button class="player-row-btn negative btn-minus-1" onclick="updateMultiPlayerScore(4, -1)">-1</button>
                        <div class="player-row-score" id="multiPlayer4Score">0</div>
                        <button class="player-row-btn positive btn-plus-1" onclick="updateMultiPlayerScore(4, 1)">+1</button>
                        <button class="player-row-btn positive btn-plus-5" onclick="updateMultiPlayerScore(4, 5)">+5</button>
                        <button class="player-row-btn positive btn-plus-10" onclick="updateMultiPlayerScore(4, 10)">+10</button>
                    </div>
                </div>
            </div>

            <div class="summary-wrapper" id="personalSummaryWrapper" style="display: none;">
                <div class="summary-section">
                    <div class="summary-title">確定点</div>
                    <div class="players-summary multi-mode" id="personalPlayersSummary">
                        <div class="player-card" id="personalPlayer1Card">
                            <div class="player-score" id="personalPlayer1TotalScore">0</div>
                        </div>
                        <div class="player-card" id="personalPlayer2Card">
                            <div class="player-score" id="personalPlayer2TotalScore">0</div>
                        </div>
                        <div class="player-card" id="personalPlayer3Card">
                            <div class="player-score" id="personalPlayer3TotalScore">0</div>
                        </div>
                    </div>
                </div>
                <div class="status-section" id="personalStatusSection">
                    <div class="status-title">生還/脱落 記録</div>
                    <div class="status-rows">
                        <div class="status-row red">
                            <label class="status-toggle">
                                <span class="status-toggle-text">生還</span>
                                <input class="status-switch-input" type="checkbox" data-player="0" onchange="handlePersonalStatusToggle(this)">
                                <span class="status-switch-track is-out">
                                    <span class="status-switch-option option-light"></span>
                                    <span class="status-switch-option option-dark"></span>
                                    <span class="status-switch-thumb"></span>
                                </span>
                                <span class="status-state-text state-out" data-player="0">移動中/脱落</span>
                            </label>
                        </div>
                        <div class="status-row yellow">
                            <label class="status-toggle">
                                <span class="status-toggle-text">生還</span>
                                <input class="status-switch-input" type="checkbox" data-player="1" onchange="handlePersonalStatusToggle(this)">
                                <span class="status-switch-track is-out">
                                    <span class="status-switch-option option-light"></span>
                                    <span class="status-switch-option option-dark"></span>
                                    <span class="status-switch-thumb"></span>
                                </span>
                                <span class="status-state-text state-out" data-player="1">移動中/脱落</span>
                            </label>
                        </div>
                        <div class="status-row green">
                            <label class="status-toggle">
                                <span class="status-toggle-text">生還</span>
                                <input class="status-switch-input" type="checkbox" data-player="2" onchange="handlePersonalStatusToggle(this)">
                                <span class="status-switch-track is-out">
                                    <span class="status-switch-option option-light"></span>
                                    <span class="status-switch-option option-dark"></span>
                                    <span class="status-switch-thumb"></span>
                                </span>
                                <span class="status-state-text state-out" data-player="2">移動中/脱落</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="summary-wrapper" id="multiSummaryWrapper" style="display: flex;">
                <div class="summary-section">
                    <div class="summary-title">確定点</div>
                    <div class="players-summary multi-mode" id="multiPlayersSummary">
                        <div class="player-card" id="multiPlayer1Card">
                            <div class="player-score" id="multiPlayer1TotalScore">0</div>
                        </div>
                        <div class="player-card" id="multiPlayer2Card">
                            <div class="player-score" id="multiPlayer2TotalScore">0</div>
                        </div>
                        <div class="player-card" id="multiPlayer3Card">
                            <div class="player-score" id="multiPlayer3TotalScore">0</div>
                        </div>
                        <div class="player-card" id="multiPlayer4Card">
                            <div class="player-score" id="multiPlayer4TotalScore">0</div>
                        </div>
                    </div>
                </div>
                <div class="status-section" id="multiStatusSection">
                    <div class="status-title">生還/脱落 記録</div>
                    <div class="status-rows">
                        <div class="status-row red">
                            <label class="status-toggle">
                                <span class="status-toggle-text">生還</span>
                                <input class="status-switch-input" type="checkbox" data-player="0" onchange="handleStatusToggle(this)">
                                <span class="status-switch-track is-out">
                                    <span class="status-switch-option option-light"></span>
                                    <span class="status-switch-option option-dark"></span>
                                    <span class="status-switch-thumb"></span>
                                </span>
                                <span class="status-state-text state-out" data-player="0">移動中/脱落</span>
                            </label>
                        </div>
                        <div class="status-row yellow">
                            <label class="status-toggle">
                                <span class="status-toggle-text">生還</span>
                                <input class="status-switch-input" type="checkbox" data-player="1" onchange="handleStatusToggle(this)">
                                <span class="status-switch-track is-out">
                                    <span class="status-switch-option option-light"></span>
                                    <span class="status-switch-option option-dark"></span>
                                    <span class="status-switch-thumb"></span>
                                </span>
                                <span class="status-state-text state-out" data-player="1">移動中/脱落</span>
                            </label>
                        </div>
                        <div class="status-row green">
                            <label class="status-toggle">
                                <span class="status-toggle-text">生還</span>
                                <input class="status-switch-input" type="checkbox" data-player="2" onchange="handleStatusToggle(this)">
                                <span class="status-switch-track is-out">
                                    <span class="status-switch-option option-light"></span>
                                    <span class="status-switch-option option-dark"></span>
                                    <span class="status-switch-thumb"></span>
                                </span>
                                <span class="status-state-text state-out" data-player="2">移動中/脱落</span>
                            </label>
                        </div>
                        <div class="status-row blue">
                            <label class="status-toggle">
                                <span class="status-toggle-text">生還</span>
                                <input class="status-switch-input" type="checkbox" data-player="3" onchange="handleStatusToggle(this)">
                                <span class="status-switch-track is-out">
                                    <span class="status-switch-option option-light"></span>
                                    <span class="status-switch-option option-dark"></span>
                                    <span class="status-switch-thumb"></span>
                                </span>
                                <span class="status-state-text state-out" data-player="3">移動中/脱落</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
    </div>

    <div class="modal-overlay" id="resetModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-message">全てのカウントを0にしても良いですか？</div>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-cancel" onclick="hideResetConfirmation()">前の画面に戻る</button>
                <button class="modal-btn modal-btn-confirm" onclick="confirmReset()">初期化する</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="helpModal" style="display: none;" role="dialog" aria-labelledby="tutorialTitle" aria-modal="true">
        <div class="modal-content modal-content-large tutorial-modal">
            <button class="modal-close-btn" onclick="hideHelpModal()" aria-label="チュートリアルを閉じる" tabindex="0">×</button>
            <div class="tutorial-container" role="document">
                <!-- ページ1: モード切り替え -->
                <div class="tutorial-page active" data-page="1">
                    <div class="tutorial-icon">👥</div>
                    <div class="tutorial-title">モード切り替え</div>
                    <div class="tutorial-text">
                        <p class="tutorial-main-text">プレイ人数を選択しましょう</p>
                        <div class="tutorial-visual-box">
                            <div class="visual-button-example">
                                <span class="example-btn">3人モード</span>
                                <span class="example-btn active-example">4人モード</span>
                                <span class="example-divider">|</span>
                                <span class="example-btn help-btn-ex">説明書</span>
                            </div>
                        </div>
                        <p class="tutorial-note">遊ぶ人数を選んでください。（2人用ルールで遊ぶ場合は、4人モードを選んでください）</p>
                    </div>
                </div>

                <!-- ページ2: ラウンド管理 -->
                <div class="tutorial-page" data-page="2">
                    <div class="tutorial-icon">🔄</div>
                    <div class="tutorial-title">ラウンド管理</div>
                    <div class="tutorial-text">
                        <p class="tutorial-main-text">4つのラウンドを切り替えられます</p>
                        <div class="tutorial-visual-box">
                            <div class="visual-round-example">
                                <span class="example-round active-round">R1</span>
                                <span class="example-round">R2</span>
                                <span class="example-round">R3</span>
                                <span class="example-round">R4</span>
                                <span class="example-divider">|</span>
                                <span class="example-round reset-round">初期化</span>
                            </div>
                        </div>
                        <div class="tutorial-steps">
                            <div class="step-item">
                                <span class="step-number">1</span>
                                <span class="step-text">R1〜R4ボタンでラウンドを選択</span>
                            </div>
                            <div class="step-item">
                                <span class="step-number">2</span>
                                <span class="step-text">各ラウンドのスコアは個別に記録されます</span>
                            </div>
                            <div class="step-item">
                                <span class="step-number">3</span>
                                <span class="step-text">初期化ボタンで全てリセット可能</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ページ3: スコア管理 -->
                <div class="tutorial-page" data-page="3">
                    <div class="tutorial-icon">🎯</div>
                    <div class="tutorial-title">スコア管理</div>
                    <div class="tutorial-text">
                        <p class="tutorial-main-text">暫定点と確定点を管理します</p>
                        <div class="tutorial-score-section">
                            <div class="score-explanation">
                                <div class="score-label">① プレイヤー暫定点</div>
                                <div class="score-desc">各ラウンドで獲得した点数を+/-ボタンで調整</div>
                                <div class="player-score-example red-player">
                                    <div class="visual-score-buttons">
                                        <span class="example-score-btn neg">-10</span>
                                        <span class="example-score-btn neg">-5</span>
                                        <span class="example-score-btn neg">-1</span>
                                        <span class="example-score-display">15</span>
                                        <span class="example-score-btn pos">+1</span>
                                        <span class="example-score-btn pos">+5</span>
                                        <span class="example-score-btn pos">+10</span>
                                    </div>
                                </div>
                                <div class="score-tip">💡 タップするたびに点数が増減します</div>
                            </div>
                            <div class="score-explanation">
                                <div class="score-label">② 確定点</div>
                                <div class="score-desc">全ラウンドの合計点が表示されます（生還時のみ加算）</div>
                                <div class="confirmed-score-example">
                                    <div class="confirmed-title">確定点</div>
                                    <div class="confirmed-scores">
                                        <div class="confirmed-card red-card">45</div>
                                        <div class="confirmed-card yellow-card">32</div>
                                        <div class="confirmed-card green-card">58</div>
                                        <div class="confirmed-card blue-card">41</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ページ4: 生還/脱落記録 -->
                <div class="tutorial-page" data-page="4">
                    <div class="tutorial-icon">⭐</div>
                    <div class="tutorial-title">生還/脱落記録</div>
                    <div class="tutorial-text">
                        <p class="tutorial-main-text">プレイヤーの状態を記録しましょう</p>
                        <div class="status-section-title">生還/脱落 記録</div>
                        <div class="tutorial-status-section">
                            <div class="status-explanation">
                                <div class="status-label-main">❌ 移動中/脱落の状態</div>
                                <div class="status-example out-state">
                                    <span class="status-label-ex">生還</span>
                                    <div class="status-switch-visual out-visual">
                                        <span class="switch-option">○</span>
                                        <span class="switch-option active-option">●</span>
                                    </div>
                                    <span class="status-text-ex">移動中/脱落</span>
                                </div>
                                <div class="status-meaning">このラウンドのスコアは確定点に加算されません</div>
                            </div>
                            <div class="status-explanation">
                                <div class="status-label-main">✅ 生還の状態</div>
                                <div class="status-example rescue-state">
                                    <span class="status-label-ex bright-label">生還</span>
                                    <div class="status-switch-visual rescue-visual">
                                        <span class="switch-option active-option">●</span>
                                        <span class="switch-option">○</span>
                                    </div>
                                    <span class="status-text-ex dimmed">移動中/脱落</span>
                                </div>
                                <div class="status-meaning bright-meaning">このラウンドのスコアが確定点に加算されます！</div>
                            </div>
                        </div>
                        <div class="tutorial-steps">
                            <div class="step-item">
                                <span class="step-number">1</span>
                                <span class="step-text">中央のスライドボタンをタップして状態を切り替え</span>
                            </div>
                            <div class="step-item">
                                <span class="step-number">2</span>
                                <span class="step-text">生還状態のみラウンドスコアが確定点に反映されます</span>
                            </div>
                            <div class="step-item">
                                <span class="step-number">3</span>
                                <span class="step-text">各ラウンドごとに個別に記録できます</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ページインジケーター -->
            <div class="tutorial-indicator">
                <span class="indicator-dot active" data-page="1"></span>
                <span class="indicator-dot" data-page="2"></span>
                <span class="indicator-dot" data-page="3"></span>
                <span class="indicator-dot" data-page="4"></span>
            </div>

            <!-- ナビゲーションボタン -->
            <div class="tutorial-navigation" role="navigation" aria-label="チュートリアルナビゲーション">
                <button class="tutorial-nav-btn prev-btn" onclick="previousTutorialPage()" style="visibility: hidden;" aria-label="前のページへ">
                    ← 前へ
                </button>
                <button class="tutorial-nav-btn next-btn" onclick="nextTutorialPage()" aria-label="次のページへ">
                    次へ →
                </button>
                <button class="tutorial-nav-btn start-btn" onclick="hideHelpModal()" style="display: none;" aria-label="チュートリアルを閉じて開始">
                    始める 🎮
                </button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
